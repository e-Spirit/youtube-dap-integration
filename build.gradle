/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/current/userguide/java_library_plugin.html
 */

buildscript {
    ext {
        fsRuntimeVersion = '5.2.220409'
    }
}

plugins {
    id 'java-library'
    id 'maven-publish'
    id 'de.espirit.firstspirit-module' version '4.1.1'
    id 'net.researchgate.release' version '2.8.1'
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
    options.release.set(11)
}

group = project.property('groupId')

repositories {
    maven {
        url = 'https://artifactory.e-spirit.hosting/artifactory/repo/'
        credentials {
            username = artifactory_hosting_username
            password = artifactory_hosting_password
        }
    }
}

dependencies {
    // FirstSpirit API
    compileOnly group: 'de.espirit.firstspirit', name: 'fs-isolated-runtime', version: "${fsRuntimeVersion}"
    // GenericConfig - a utility lib to create <configurable> dialogs
    // https://community.crownpeak.com/t5/Tutorials-and-How-Tos/GenericConfig-a-utility-lib-to-create-lt-configurable-gt-dialogs/ba-p/50669
    fsModuleCompile group: 'com.espirit.ps.psci.module', name: 'generic-configuration', version: '2.8.0'
    fsWebCompile group: 'com.espirit.ps.psci.module', name: 'generic-configuration', version: '2.8.0'
    // YouTube Data API
    fsModuleCompile group: 'com.google.apis', name: 'google-api-services-youtube', version: 'v3-rev222-1.25.0'
    fsWebCompile group: 'com.google.apis', name: 'google-api-services-youtube', version: 'v3-rev222-1.25.0'
    // Test dependencies
    testImplementation group: 'de.espirit.firstspirit', name: 'fs-isolated-runtime', version: "${fsRuntimeVersion}"
    testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter', version: '5.7.1'
    testImplementation group: 'org.mockito', name: 'mockito-core', version: '3.+'
    testImplementation group: 'org.mockito', name: 'mockito-junit-jupiter', version: '3.+'
    testImplementation group: 'org.mockito', name: 'mockito-inline', version: '3.+'
}

/*
 * Enabling the Gradle's Native JUnit 5 Support
 */

test {
    useJUnitPlatform()
}

/*
 * FirstSpirit Module Plugin configuration
 */

firstSpiritModule {
    moduleName = project.property('firstSpiritModule.moduleName')
    displayName = project.property('firstSpiritModule.displayName')
    description = project.property('firstSpiritModule.description')
    vendor = project.property('firstSpiritModule.vendor')
}

/*
 * Maven Publish Plugin configuration
 */

publishing {
    repositories {
        maven {
            credentials {
                username = artifactory_hosting_username
                password = artifactory_hosting_password
            }
            url "https://artifactory.e-spirit.hosting/artifactory/${version.endsWith("SNAPSHOT") ? project.property('publishing.snapshotRepository') : project.property('publishing.releaseRepository') }"
        }
    }
    publications {
        fsm(MavenPublication) {
            artifactId project.name
            artifact assembleFSM
        }
    }
}

/*
 * Release Plugin configuration
 */

release {
    ignoredSnapshotDependencies = ['de.espirit.firstspirit:fs-license']
}

/*
 * publish artifacts after release
 */

allprojects { p ->
    afterEvaluate {
        rootProject.afterReleaseBuild.dependsOn p.tasks.matching { it.name == 'publish' }
    }
}

/*
 * Verify gradle.properties values
 */

afterEvaluate {
    ['groupId', 'firstSpiritModule.moduleName', 'firstSpiritModule.displayName', 'firstSpiritModule.vendor' , 'publishing.releaseRepository', 'publishing.snapshotRepository'].each {
        if (!project.hasProperty(it) || (project.property(it) as String).trim().empty) {
            throw new GradleException("Property '${it}' in gradle.properties must not be empty!")
        }
    }
}

tasks.withType(JavaCompile) {
    options.compilerArgs += ['-Xlint:deprecation']
    options.compilerArgs += ['-Xlint:unchecked']
}
